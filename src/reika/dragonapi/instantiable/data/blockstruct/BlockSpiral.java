/*******************************************************************************
 * @author Reika Kalseki
 * 
 * Copyright 2016
 * 
 * All rights reserved.
 * Distribution of the software in any form is only allowed with
 * explicit, prior permission from the owner.
 ******************************************************************************/
package reika.dragonapi.instantiable.data.blockstruct;

import net.minecraftforge.common.util.ForgeDirection;
import reika.dragonapi.exception.MisuseException;
import reika.dragonapi.instantiable.data.immutable.Coordinate;
import reika.dragonapi.libraries.ReikaDirectionHelper;

public class BlockSpiral {

	private final BlockArray blocks = new BlockArray();
	private boolean rightHanded;
	public final int originX;
	public final int originY;
	public final int originZ;
	public final int radius;

	private int gridSize = 1;

	private int posX;
	private int posY;
	private int posZ;
	private ForgeDirection step = ForgeDirection.NORTH;

	public BlockSpiral(int x, int y, int z, int r) {
		originX = x;
		originY = y;
		originZ = z;
		radius = r;
	}

	public BlockSpiral setRightHanded() {
		rightHanded = true;
		return this;
	}

	public BlockSpiral setGridSize(int s) {
		gridSize = s;
		return this;
	}

	public BlockSpiral setInitialDirection(ForgeDirection dir) {
		if (dir.offsetY != 0)
			throw new MisuseException("Spirals are not designed for vertical directions!");
		step = dir;
		return this;
	}

	public BlockSpiral calculate() {
		blocks.clear();
		posX = originX;
		posY = originY;
		posZ = originZ;
		blocks.addBlockCoordinate(posX, posY, posZ);

		while (Math.abs(posX-originX) <= radius*gridSize && Math.abs(posY-originY) <= radius*gridSize && Math.abs(posZ-originZ) <= radius*gridSize) {
			posX += step.offsetX*gridSize;
			posY += step.offsetY*gridSize;
			posZ += step.offsetZ*gridSize;
			blocks.addBlockCoordinate(posX, posY, posZ);
			ForgeDirection dir = rightHanded ? ReikaDirectionHelper.getRightBy90(step) : ReikaDirectionHelper.getLeftBy90(step);
			if (!blocks.hasBlock(posX+dir.offsetX*gridSize, posY+dir.offsetY*gridSize, posZ+dir.offsetZ*gridSize)) {
				step = dir;
			}
		}

		return this;
	}

	public Coordinate getNthBlock(int n) {
		return blocks.getNthBlock(n);
	}

	public Coordinate getNextAndMoveOn() {
		return blocks.getNextAndMoveOn();
	}

	public int getSize() {
		return blocks.getSize();
	}

	public boolean isEmpty() {
		return blocks.isEmpty();
	}

}
